<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë²„íŠ¼ ì—…ë°ì´íŠ¸ ë””ë²„ê·¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .debug-section {
            background: #f0f0f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status-pending {
            background: #95a5a6;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
        }
        .status-confirmed {
            background: #27ae60;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
        }
        pre {
            background: #333;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: #3498db;
            color: white;
        }
        button:hover {
            opacity: 0.8;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .success {
            color: green;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ë²„íŠ¼ ì—…ë°ì´íŠ¸ ë””ë²„ê·¸ í˜ì´ì§€</h1>
    
    <div class="debug-section">
        <h2>í˜„ì¬ ì„¸ì…˜ ë°ì´í„°</h2>
        <h3>appliedMeetings:</h3>
        <pre id="appliedMeetings"></pre>
        
        <h3>selectedMeeting:</h3>
        <pre id="selectedMeeting"></pre>
        
        <h3>ì‚¬ìš©ì ì •ë³´:</h3>
        <pre id="userInfo"></pre>
    </div>
    
    <div class="debug-section">
        <h2>í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h2>
        <button onclick="simulateApplication('progressive')">ì§„ë³´ ëª¨ì„ ì‹ ì²­ ì‹œë®¬ë ˆì´ì…˜</button>
        <button onclick="simulateApplication('conservative')">ë³´ìˆ˜ ëª¨ì„ ì‹ ì²­ ì‹œë®¬ë ˆì´ì…˜</button>
        <button onclick="simulatePaymentComplete('progressive')">ì§„ë³´ ëª¨ì„ ê²°ì œ ì™„ë£Œ ì‹œë®¬ë ˆì´ì…˜</button>
        <button onclick="simulatePaymentComplete('conservative')">ë³´ìˆ˜ ëª¨ì„ ê²°ì œ ì™„ë£Œ ì‹œë®¬ë ˆì´ì…˜</button>
        <button onclick="clearApplications()">ì‹ ì²­ ë‚´ì—­ ì´ˆê¸°í™”</button>
    </div>
    
    <div class="debug-section">
        <h2>ë²„íŠ¼ ìƒíƒœ ì²´í¬</h2>
        <button onclick="checkButtonState()">index.html ë²„íŠ¼ ìƒíƒœ í™•ì¸</button>
        <button onclick="window.open('index.html', '_blank')">index.html ìƒˆ íƒ­ì—ì„œ ì—´ê¸°</button>
        <button onclick="window.open('index.html?from=payment-complete', '_blank')">index.html ì—´ê¸° (ê²°ì œì™„ë£Œ íŒŒë¼ë¯¸í„°)</button>
    </div>
    
    <div class="debug-section">
        <h2>ì‹¤í–‰ ë¡œê·¸</h2>
        <div id="log"></div>
    </div>
    
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            logDiv.innerHTML += `<div class="${className}">[${time}] ${message}</div>`;
        }
        
        function updateDisplay() {
            // appliedMeetings í‘œì‹œ
            const appliedMeetings = sessionStorage.getItem('appliedMeetings');
            document.getElementById('appliedMeetings').textContent = 
                appliedMeetings ? JSON.stringify(JSON.parse(appliedMeetings), null, 2) : 'null';
            
            // selectedMeeting í‘œì‹œ
            const selectedMeeting = sessionStorage.getItem('selectedMeeting');
            document.getElementById('selectedMeeting').textContent = 
                selectedMeeting ? JSON.stringify(JSON.parse(selectedMeeting), null, 2) : 'null';
            
            // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
            const userInfo = {
                isLoggedIn: sessionStorage.getItem('isLoggedIn'),
                userEmail: sessionStorage.getItem('userEmail'),
                userGender: sessionStorage.getItem('userGender'),
                politicalType: sessionStorage.getItem('politicalType')
            };
            document.getElementById('userInfo').textContent = JSON.stringify(userInfo, null, 2);
        }
        
        function simulateApplication(orientation) {
            // ë¯¸íŒ… ì •ë³´ ì„¤ì •
            const meetingInfo = {
                id: `meeting_${orientation}_${Date.now()}`,
                title: `${orientation === 'progressive' ? 'ì§„ë³´' : 'ë³´ìˆ˜'} ì„±í–¥ ì†Œê°œíŒ…`,
                date: `8ì›” ${orientation === 'progressive' ? '23' : '30'}ì¼ í† ìš”ì¼`,
                location: 'ğŸ“ ê°•ë‚¨ì—­ ì¹´í˜',
                time: 'â° ì˜¤í›„ 3ì‹œ',
                fee: 45000,
                orientation: orientation
            };
            sessionStorage.setItem('selectedMeeting', JSON.stringify(meetingInfo));
            
            // ì‹ ì²­ ì •ë³´ ì¶”ê°€
            const appliedMeetings = JSON.parse(sessionStorage.getItem('appliedMeetings') || '{}');
            appliedMeetings[orientation] = {
                status: 'pending',
                appliedAt: new Date().toISOString(),
                orientation: orientation,
                gender: sessionStorage.getItem('userGender') || 'male',
                meetingId: meetingInfo.id
            };
            sessionStorage.setItem('appliedMeetings', JSON.stringify(appliedMeetings));
            
            log(`${orientation} ëª¨ì„ ì‹ ì²­ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ`, 'success');
            updateDisplay();
        }
        
        function simulatePaymentComplete(orientation) {
            const appliedMeetings = JSON.parse(sessionStorage.getItem('appliedMeetings') || '{}');
            if (appliedMeetings[orientation]) {
                // payment-complete-script.jsì™€ ë™ì¼í•˜ê²Œ statusë¥¼ 'payment_completed'ë¡œ ì„¤ì •
                appliedMeetings[orientation].status = 'payment_completed';
                appliedMeetings[orientation].paymentCompletedAt = new Date().toISOString();
                appliedMeetings[orientation].paymentInfo = {
                    orderId: 'TEST-' + Date.now(),
                    method: 'transfer'
                };
                sessionStorage.setItem('appliedMeetings', JSON.stringify(appliedMeetings));
                log(`${orientation} ëª¨ì„ payment_completed ìƒíƒœë¡œ ë³€ê²½`, 'success');
                log(`Status: ${appliedMeetings[orientation].status}`, 'info');
            } else {
                log(`${orientation} ëª¨ì„ ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤`, 'error');
            }
            updateDisplay();
        }
        
        function clearApplications() {
            sessionStorage.removeItem('appliedMeetings');
            sessionStorage.removeItem('selectedMeeting');
            log('ì‹ ì²­ ë‚´ì—­ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
            updateDisplay();
        }
        
        function checkButtonState() {
            // ë””ë²„ê¹… ì½”ë“œ íŒì—…
            const popup = window.open('', 'button-check', 'width=800,height=600');
            const appliedMeetings = JSON.parse(sessionStorage.getItem('appliedMeetings') || '{}');
            
            popup.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>ë²„íŠ¼ ìƒíƒœ ë””ë²„ê¹… ì½”ë“œ</title>
                    <style>
                        body { font-family: monospace; padding: 20px; }
                        pre { background: #f0f0f0; padding: 15px; border-radius: 5px; overflow-x: auto; }
                        .section { margin: 20px 0; }
                        h3 { color: #e60012; }
                        .copy-btn { 
                            background: #3498db; 
                            color: white; 
                            border: none; 
                            padding: 5px 10px; 
                            border-radius: 3px; 
                            cursor: pointer; 
                            margin-left: 10px;
                        }
                    </style>
                </head>
                <body>
                    <h2>ğŸ” ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‹¤í–‰í•  ë””ë²„ê¹… ì½”ë“œ</h2>
                    
                    <div class="section">
                        <h3>1. í˜„ì¬ ìƒíƒœ í™•ì¸</h3>
                        <button class="copy-btn" onclick="navigator.clipboard.writeText(document.getElementById('code1').textContent)">ë³µì‚¬</button>
                        <pre id="code1">
// === ì „ì²´ ìƒíƒœ í™•ì¸ ===
console.log('=== DEBUGGING BUTTON UPDATE ISSUE ===');
console.log('í˜„ì¬ ì‹œê°„:', new Date().toISOString());

// 1. SessionStorage í™•ì¸
const appliedMeetings = JSON.parse(sessionStorage.getItem('appliedMeetings') || '{}');
console.log('\\n1. appliedMeetings:', appliedMeetings);

// 2. ê° orientationë³„ ìƒíƒœ í™•ì¸
['progressive', 'conservative'].forEach(orientation => {
    if (appliedMeetings[orientation]) {
        console.log(\`\\n\${orientation} ëª¨ì„ ìƒíƒœ:\`);
        console.log('- status:', appliedMeetings[orientation].status);
        console.log('- paymentCompletedAt:', appliedMeetings[orientation].paymentCompletedAt);
        console.log('- is payment_completed?', appliedMeetings[orientation].status === 'payment_completed');
    }
});

// 3. userMeetingInfo ì „ì—­ ë³€ìˆ˜ í™•ì¸
console.log('\\n2. userMeetingInfo ì „ì—­ ë³€ìˆ˜:', window.userMeetingInfo);

// 4. ë²„íŠ¼ ìƒíƒœ í™•ì¸
console.log('\\n3. í˜„ì¬ ë²„íŠ¼ ìƒíƒœ:');
document.querySelectorAll('.meeting-header').forEach(header => {
    const orientation = header.classList.contains('progressive') ? 'progressive' : 'conservative';
    const button = header.parentElement.querySelector('.btn-apply');
    if (button) {
        console.log(\`\\n\${orientation} ë²„íŠ¼:\`);
        console.log('- í…ìŠ¤íŠ¸:', button.textContent);
        console.log('- í´ë˜ìŠ¤:', button.className);
        console.log('- ìŠ¤íƒ€ì¼:', button.getAttribute('style'));
        console.log('- disabled:', button.disabled);
    }
});</pre>
                    </div>
                    
                    <div class="section">
                        <h3>2. updateMeetingButtons í•¨ìˆ˜ ì¶”ì </h3>
                        <button class="copy-btn" onclick="navigator.clipboard.writeText(document.getElementById('code2').textContent)">ë³µì‚¬</button>
                        <pre id="code2">
// updateMeetingButtons í•¨ìˆ˜ ì‹¤í–‰ ë° ì¶”ì 
console.log('\\n=== updateMeetingButtons ì‹¤í–‰ ì¶”ì  ===');

// ì„ì‹œë¡œ fetchUserMeetingInfo í•¨ìˆ˜ ë˜í•‘
const originalFetch = window.fetchUserMeetingInfo;
window.fetchUserMeetingInfo = async function() {
    console.log('fetchUserMeetingInfo í˜¸ì¶œë¨');
    await originalFetch.call(this);
    console.log('fetchUserMeetingInfo ì™„ë£Œ, userMeetingInfo:', window.userMeetingInfo);
};

// updateMeetingButtonsUI í•¨ìˆ˜ ë˜í•‘
const originalUpdateUI = window.updateMeetingButtonsUI;
window.updateMeetingButtonsUI = function() {
    console.log('updateMeetingButtonsUI í˜¸ì¶œë¨');
    originalUpdateUI.call(this);
};

// updateButtonForMeeting í•¨ìˆ˜ ë˜í•‘
const originalUpdateButton = window.updateButtonForMeeting;
window.updateButtonForMeeting = function(orientation, applicationData) {
    console.log(\`updateButtonForMeeting í˜¸ì¶œ: \${orientation}\`, applicationData);
    originalUpdateButton.call(this, orientation, applicationData);
};

// ì´ì œ í•¨ìˆ˜ ì‹¤í–‰
await updateMeetingButtons();
console.log('updateMeetingButtons ì‹¤í–‰ ì™„ë£Œ');</pre>
                    </div>
                    
                    <div class="section">
                        <h3>3. ê°•ì œ ì—…ë°ì´íŠ¸</h3>
                        <button class="copy-btn" onclick="navigator.clipboard.writeText(document.getElementById('code3').textContent)">ë³µì‚¬</button>
                        <pre id="code3">
// payment_completed ìƒíƒœë¡œ ìˆ˜ë™ ì—…ë°ì´íŠ¸ í›„ ë²„íŠ¼ ìƒˆë¡œê³ ì¹¨
const orientation = 'conservative'; // ë˜ëŠ” 'progressive'

// 1. appliedMeetings ì—…ë°ì´íŠ¸
const appliedMeetings = JSON.parse(sessionStorage.getItem('appliedMeetings') || '{}');
if (appliedMeetings[orientation]) {
    console.log('ì´ì „ ìƒíƒœ:', appliedMeetings[orientation].status);
    appliedMeetings[orientation].status = 'payment_completed';
    appliedMeetings[orientation].paymentCompletedAt = new Date().toISOString();
    sessionStorage.setItem('appliedMeetings', JSON.stringify(appliedMeetings));
    console.log('ìƒˆ ìƒíƒœ:', appliedMeetings[orientation].status);
}

// 2. userMeetingInfo ì§ì ‘ ì—…ë°ì´íŠ¸
if (window.userMeetingInfo) {
    window.userMeetingInfo[orientation] = {
        status: 'payment_completed',
        meetingId: appliedMeetings[orientation]?.meetingId || 'test-123'
    };
    console.log('userMeetingInfo ì—…ë°ì´íŠ¸ë¨:', window.userMeetingInfo);
}

// 3. ë²„íŠ¼ UI ì§ì ‘ ì—…ë°ì´íŠ¸
updateButtonForMeeting(orientation, window.userMeetingInfo[orientation]);

// 4. ë²„íŠ¼ ìƒíƒœ í™•ì¸
setTimeout(() => {
    const header = document.querySelector(\`.meeting-header.\${orientation}\`);
    const button = header?.parentElement.querySelector('.btn-apply');
    console.log('ì—…ë°ì´íŠ¸ í›„ ë²„íŠ¼:', {
        text: button?.textContent,
        class: button?.className,
        style: button?.getAttribute('style')
    });
}, 100);</pre>
                    </div>
                    
                    <div class="section">
                        <h3>í˜„ì¬ appliedMeetings ìƒíƒœ:</h3>
                        <pre>${JSON.stringify(appliedMeetings, null, 2)}</pre>
                    </div>
                </body>
                </html>
            `);
        }
        
        // ì´ˆê¸° í‘œì‹œ
        updateDisplay();
        
        // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ë³€ê²½ ê°ì§€
        window.addEventListener('storage', function(e) {
            if (e.key === 'appliedMeetings' || e.key === 'selectedMeeting') {
                log(`ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ë³€ê²½ ê°ì§€: ${e.key}`, 'info');
                updateDisplay();
            }
        });
        
        // ë¡œê·¸ì¸ ìƒíƒœ ì‹œë®¬ë ˆì´ì…˜
        if (!sessionStorage.getItem('isLoggedIn')) {
            sessionStorage.setItem('isLoggedIn', 'true');
            sessionStorage.setItem('userEmail', 'test@example.com');
            sessionStorage.setItem('userGender', 'male');
            sessionStorage.setItem('politicalType', 'MPOS');
            log('í…ŒìŠ¤íŠ¸ìš© ë¡œê·¸ì¸ ìƒíƒœ ì„¤ì • ì™„ë£Œ', 'success');
            updateDisplay();
        }
    </script>
</body>
</html>