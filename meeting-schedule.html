<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>소개팅 일정 - 사이드픽</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="schedule-styles.css">
    <style>
        /* 모달 스타일 오버라이드 - footer 위에 표시되도록 */
        #paymentModal.payment-modal-overlay {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            z-index: 999999 !important;
            display: none;
            justify-content: center !important;
            align-items: center !important;
            background-color: rgba(0, 0, 0, 0.7) !important;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            overflow-y: auto !important;
            -webkit-overflow-scrolling: touch !important;
        }
        
        #paymentModal.payment-modal-overlay[style*="flex"] {
            display: flex !important;
        }
        
        #paymentModal .payment-modal-content {
            position: relative !important;
            z-index: 1000000 !important;
            background: white !important;
            border-radius: 20px !important;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
            max-width: 480px !important;
            width: 90% !important;
            max-height: 90vh !important;
            padding: 0 !important;
            overflow: hidden !important;
            animation: modalSlideIn 0.3s ease-out !important;
            margin: 20px auto !important;
            overflow-y: auto !important;
            -webkit-overflow-scrolling: touch !important;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        #paymentModal .modal-close {
            position: absolute !important;
            top: 20px !important;
            right: 20px !important;
            width: 36px !important;
            height: 36px !important;
            border-radius: 50% !important;
            background: rgba(0, 0, 0, 0.05) !important;
            border: none !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 24px !important;
            color: #666 !important;
            transition: all 0.2s ease !important;
            z-index: 10 !important;
        }
        
        #paymentModal .modal-close:hover {
            background: rgba(0, 0, 0, 0.1) !important;
            color: #333 !important;
            transform: rotate(90deg) !important;
        }
        
        #paymentModal .modal-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            font-size: 24px !important;
            font-weight: 700 !important;
            padding: 30px 30px 25px !important;
            margin: 0 !important;
            text-align: center !important;
        }
        
        #paymentModal .modal-section {
            padding: 30px !important;
            margin: 0 !important;
        }
        
        #paymentModal .modal-section h3 {
            display: none !important;
        }
        
        #paymentModal .payment-info-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%) !important;
            border-radius: 15px !important;
            padding: 25px !important;
            margin-bottom: 20px !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08) !important;
        }
        
        #paymentModal .info-row {
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            padding: 15px 0 !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06) !important;
        }
        
        #paymentModal .info-row:last-child {
            border-bottom: none !important;
        }
        
        #paymentModal .info-label {
            color: #666 !important;
            font-size: 15px !important;
            font-weight: 500 !important;
        }
        
        #paymentModal .info-value {
            color: #2c3e50 !important;
            font-size: 16px !important;
            font-weight: 700 !important;
        }
        
        #paymentModal .info-value.highlight {
            color: #5f3dc4 !important;
            font-size: 17px !important;
            background: rgba(103, 126, 234, 0.1) !important;
            padding: 8px 15px !important;
            border-radius: 8px !important;
        }
        
        #paymentModal .payment-notice {
            background: #fff3cd !important;
            border: 1px solid #ffeaa7 !important;
            border-radius: 10px !important;
            padding: 12px 18px !important;
            margin: 12px 0 !important;
            color: #856404 !important;
            font-size: 14px !important;
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
        }
        
        #paymentModal .payment-notice:before {
            content: "⚠️" !important;
            font-size: 18px !important;
        }
        
        #paymentModal .modal-actions {
            background: #f8f9fa !important;
            padding: 20px 30px !important;
            display: flex !important;
            gap: 12px !important;
            margin: 0 !important;
            border-top: 1px solid #e9ecef !important;
        }
        
        #paymentModal .btn-secondary,
        #paymentModal .btn-primary {
            flex: 1 !important;
            padding: 14px 24px !important;
            border: none !important;
            border-radius: 10px !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        #paymentModal .btn-secondary {
            background: white !important;
            color: #495057 !important;
            border: 2px solid #dee2e6 !important;
        }
        
        #paymentModal .btn-secondary:hover {
            background: #f8f9fa !important;
            border-color: #adb5bd !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1) !important;
        }
        
        #paymentModal .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3) !important;
        }
        
        #paymentModal .btn-primary:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 7px 20px rgba(102, 126, 234, 0.4) !important;
        }
        
        #paymentModal .btn-primary:active,
        #paymentModal .btn-secondary:active {
            transform: translateY(0) !important;
        }
    </style>
    <script src="gtm-loader.js"></script>
    <script src="auth-system.js"></script>
    <!-- data-system.js 제거 - Firebase 직접 사용 -->
    <script src="auth-check.js"></script>
    <script src="api-client.js"></script>
</head>
<body>
    <!-- 헤더 -->
    <header class="header">
        <nav class="nav-container">
            <div class="logo">
                <a href="index.html">사이드픽</a>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html#intro">서비스 소개</a></li>
                <li><a href="index.html#test">성향 테스트</a></li>
                <li><a href="index.html#meeting">오프라인 소개팅</a></li>
                <li><a href="index.html#faq">자주 묻는 질문</a></li>
            </ul>
            <div class="nav-cta">
                <a href="political-test.html?logged_in=true" class="nav-btn">성향 테스트 받기</a>
            </div>
        </nav>
    </header>

    <!-- 모임 일정 섹션 -->
    <section class="schedule-section">
        <div class="container">
            <div class="user-type-info">
                <h1>당신의 정치 성향</h1>
                <div class="type-display">
                    <span id="user-type-icon">🌐</span>
                    <h2 id="user-type-title">시장 다원주의자</h2>
                </div>
                <p id="orientation-text" class="orientation-info">진보 성향 소개팅에 참여하실 수 있습니다</p>
            </div>

            <div class="schedule-content">
                <h2>8월 소개팅 일정</h2>
                <div id="progressive-meetings" class="meetings-section">
                    <h3 class="orientation-label progressive">진보 성향 소개팅</h3>
                    <div class="meetings-grid">
                        <div class="meeting-card">
                            <div class="meeting-date">
                                <span class="day">23</span>
                                <span class="month">8월</span>
                                <span class="weekday">토요일</span>
                            </div>
                            <div class="meeting-info">
                                <h4>강남 진보 성향 소개팅</h4>
                                <p class="location">📍 강남역 파티룸</p>
                                <p class="time">⏰ 오후 3시 - 5시</p>
                                <p class="participants">
                                    <span class="male-count" data-gender="male" data-current="0">👨 남자 0/4명</span>
                                    <span class="female-count" data-gender="female" data-current="0">👩 여자 0/4명</span>
                                </p>
                                <div class="type-tags">
                                    <span class="type-tag">시장 다원주의자</span>
                                    <span class="type-tag">테크노 자유주의자</span>
                                    <span class="type-tag">참여 자유주의자</span>
                                    <span class="type-tag">엘리트 자유주의자</span>
                                    <span class="type-tag">참여 사회민주주의자</span>
                                    <span class="type-tag">전문가 사회민주주의자</span>
                                    <span class="type-tag">민중 진보주의자</span>
                                    <span class="type-tag">계획 진보주의자</span>
                                </div>
                            </div>
                            <div class="meeting-actions">
                                <button class="apply-btn" onclick="applyMeeting(this)">신청하기</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="conservative-meetings" class="meetings-section">
                    <h3 class="orientation-label conservative">보수 성향 소개팅</h3>
                    <div class="meetings-grid">
                        <div class="meeting-card">
                            <div class="meeting-date">
                                <span class="day">30</span>
                                <span class="month">8월</span>
                                <span class="weekday">토요일</span>
                            </div>
                            <div class="meeting-info">
                                <h4>강남 보수 성향 소개팅</h4>
                                <p class="location">📍 강남역 파티룸</p>
                                <p class="time">⏰ 오후 3시 - 5시</p>
                                <p class="participants">
                                    <span class="male-count" data-gender="male" data-current="0">👨 남자 0/4명</span>
                                    <span class="female-count" data-gender="female" data-current="0">👩 여자 0/4명</span>
                                </p>
                                <div class="type-tags">
                                    <span class="type-tag">문화 보수주의자</span>
                                    <span class="type-tag">온건 보수주의자</span>
                                    <span class="type-tag">풀뿌리 보수주의자</span>
                                    <span class="type-tag">전통 보수주의자</span>
                                    <span class="type-tag">온건 국가주의자</span>
                                    <span class="type-tag">권위 보수주의자</span>
                                    <span class="type-tag">민족 보수주의자</span>
                                    <span class="type-tag">위계 보수주의자</span>
                                </div>
                            </div>
                            <div class="meeting-actions">
                                <button class="apply-btn" onclick="applyMeeting(this)">신청하기</button>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>

            <div class="notice-box">
                <h3>📌 소개팅 안내사항</h3>
                <ul>
                    <li>모든 소개팅은 8명(남성 4명, 여성 4명)으로 구성됩니다</li>
                    <li>참가비는 1인당 45,000원입니다</li>
                    <li>본인 성별에 해당하는 자리만 신청 가능합니다</li>
                    <li>성별 자리가 마감된 경우 알림 신청이 가능합니다</li>
                    <li>신청 후 24시간 이내에 확정 안내를 받으실 수 있습니다</li>
                    <li>소개팅 3일 전까지 취소 가능하며, 이후 취소 시 환불이 제한됩니다</li>
                    <li>같은 정치 성향을 가진 분들끼리만 모이므로 편안한 대화가 가능합니다</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- 푸터 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>사이드픽</h3>
                    <p>정치 성향 기반 오프라인 만남 서비스</p>
                </div>
                <div class="footer-section">
                    <h4>서비스</h4>
                    <ul>
                        <li><a href="javascript:void(0)" onclick="checkAndGoToTest()">성향 테스트</a></li>
                        <li><a href="meeting-schedule.html">모임 일정</a></li>
                        <li><a href="index.html#faq">자주 묻는 질문</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>고객센터</h4>
                    <ul>
                        <li>평일 10:00 - 18:00</li>
                        <li><a href="mailto:clsrna3@naver.com">clsrna3@naver.com</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>정책</h4>
                    <ul>
                        <li><a href="terms.html">이용약관</a></li>
                        <li><a href="privacy.html">개인정보처리방침</a></li>
                        <li><a href="refund.html">환불정책</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 사이드픽. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- 결제 정보 모달 -->
    <div id="paymentModal" class="payment-modal-overlay" style="display: none;">
        <div class="payment-modal-content">
            <span class="modal-close" onclick="closePaymentModal()">&times;</span>
            <h2 class="modal-title">결제 정보</h2>
            
            <div class="modal-section">
                <h3>결제 정보</h3>
                <div class="payment-info-box">
                    <div class="info-row">
                        <span class="info-label">참가비:</span>
                        <span class="info-value">45,000원</span>
                    </div>
                    <div class="info-row">
                        <span class="info-value highlight">신한은행 110-386-140132 (배은호)</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">입금자명:</span>
                        <span id="modal-depositor-name" class="info-value"></span>
                    </div>
                </div>
                <p class="payment-notice">* 입금 확인 후 참가가 확정됩니다.</p>
                <p class="payment-notice">* 입금 기한: 신청일로부터 24시간 이내</p>
            </div>
            
            <div class="modal-actions">
                <button class="btn-secondary" onclick="copyAccountNumber()">계좌번호 복사</button>
                <button class="btn-primary" onclick="closePaymentModal()">확인</button>
            </div>
        </div>
    </div>

    <script src="schedule-script.js?v=7"></script>
    <script src="attendance-update.js"></script>
    
    <!-- 참석 인원 실시간 업데이트 -->
    <script>
        (function() {
            console.log('참석 인원 업데이트 스크립트 시작');
            
            function updateAttendance() {
                console.log('참석 인원 업데이트 중...');
                
                fetch('https://sidepick.onrender.com/api/meetings/attendance')
                    .then(response => response.json())
                    .then(data => {
                        console.log('API 응답:', data);
                        
                        if (data.success && data.data) {
                            // 진보 모임
                            let progressiveMale = 0;
                            let progressiveFemale = 0;
                            
                            // 보수 모임
                            let conservativeMale = 0;
                            let conservativeFemale = 0;
                            
                            // 데이터 집계
                            Object.values(data.data).forEach(meeting => {
                                if (meeting.orientation === 'progressive') {
                                    progressiveMale += meeting.male;
                                    progressiveFemale += meeting.female;
                                } else if (meeting.orientation === 'conservative') {
                                    conservativeMale += meeting.male;
                                    conservativeFemale += meeting.female;
                                }
                            });
                            
                            // 모든 male-count와 female-count 요소 찾기
                            document.querySelectorAll('.meeting-card').forEach(card => {
                                const isProgressive = card.closest('#progressive-meetings');
                                const isConservative = card.closest('#conservative-meetings');
                                
                                const maleCount = card.querySelector('.male-count');
                                const femaleCount = card.querySelector('.female-count');
                                
                                if (isProgressive) {
                                    if (maleCount) maleCount.textContent = `👨 남자 ${progressiveMale}/4명`;
                                    if (femaleCount) femaleCount.textContent = `👩 여자 ${progressiveFemale}/4명`;
                                } else if (isConservative) {
                                    if (maleCount) maleCount.textContent = `👨 남자 ${conservativeMale}/4명`;
                                    if (femaleCount) femaleCount.textContent = `👩 여자 ${conservativeFemale}/4명`;
                                }
                            });
                            
                            console.log('업데이트 완료 - 진보:', progressiveMale, '남/', progressiveFemale, '여, 보수:', conservativeMale, '남/', conservativeFemale, '여');
                        }
                    })
                    .catch(error => {
                        console.error('API 호출 실패:', error);
                    });
            }
            
            updateAttendance()
        })();
    </script>
</body>
</html>