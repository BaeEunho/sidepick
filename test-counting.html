<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>참가자 카운팅 테스트</title>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn-primary {
            background: #3498db;
            color: white;
        }
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        .btn-success {
            background: #27ae60;
            color: white;
        }
        .count-display {
            font-size: 18px;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>참가자 카운팅 시스템 테스트</h1>

    <div class="test-section">
        <h2>현재 참가자 수</h2>
        <div id="counts" class="count-display">로딩중...</div>
    </div>

    <div class="test-section">
        <h2>보수 성향 미팅</h2>
        <button class="btn-primary" onclick="addParticipant('conservative', 'male')">남성 추가</button>
        <button class="btn-primary" onclick="addParticipant('conservative', 'female')">여성 추가</button>
    </div>

    <div class="test-section">
        <h2>진보 성향 미팅</h2>
        <button class="btn-success" onclick="addParticipant('progressive', 'male')">남성 추가</button>
        <button class="btn-success" onclick="addParticipant('progressive', 'female')">여성 추가</button>
    </div>

    <div class="test-section">
        <h2>관리 기능</h2>
        <button class="btn-danger" onclick="resetCounts()">카운트 초기화</button>
        <button onclick="refreshDisplay()">새로고침</button>
        <button onclick="simulateBooking()">예약 시뮬레이션</button>
    </div>

    <div class="log" id="log">로그가 여기에 표시됩니다...</div>

    <script>
        // 로그 함수
        function log(message) {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent = `[${timestamp}] ${message}\n` + logEl.textContent;
        }

        // 카운트 표시 업데이트
        function refreshDisplay() {
            const counts = JSON.parse(sessionStorage.getItem('meetingCounts') || '{}');
            
            // 기본값 설정
            if (!counts.conservative) counts.conservative = { male: 0, female: 0 };
            if (!counts.progressive) counts.progressive = { male: 0, female: 0 };
            
            const display = document.getElementById('counts');
            display.innerHTML = `
                <strong>보수 성향:</strong> 남성 ${counts.conservative.male}/4, 여성 ${counts.conservative.female}/4<br>
                <strong>진보 성향:</strong> 남성 ${counts.progressive.male}/4, 여성 ${counts.progressive.female}/4
            `;
            
            log('카운트 표시 업데이트됨');
        }

        // 참가자 추가
        function addParticipant(orientation, gender) {
            const counts = JSON.parse(sessionStorage.getItem('meetingCounts') || '{}');
            
            if (!counts[orientation]) {
                counts[orientation] = { male: 0, female: 0 };
            }
            
            if (counts[orientation][gender] >= 4) {
                alert(`${orientation === 'progressive' ? '진보' : '보수'} ${gender === 'male' ? '남성' : '여성'} 자리가 모두 찼습니다!`);
                log(`추가 실패: ${orientation} ${gender} 자리 마감`);
                return;
            }
            
            counts[orientation][gender]++;
            sessionStorage.setItem('meetingCounts', JSON.stringify(counts));
            
            log(`참가자 추가: ${orientation} ${gender} (현재 ${counts[orientation][gender]}/4)`);
            refreshDisplay();
        }

        // 카운트 초기화
        function resetCounts() {
            sessionStorage.setItem('meetingCounts', JSON.stringify({
                progressive: { male: 0, female: 0 },
                conservative: { male: 0, female: 0 }
            }));
            log('모든 카운트가 초기화되었습니다');
            refreshDisplay();
        }

        // 예약 시뮬레이션
        function simulateBooking() {
            // 사용자 정보 설정
            sessionStorage.setItem('userGender', 'male');
            sessionStorage.setItem('politicalType', 'MPOS'); // 진보 성향
            
            // 미팅 정보 설정
            const meetingInfo = {
                id: 'test-meeting',
                title: '테스트 소개팅',
                orientation: 'progressive'
            };
            sessionStorage.setItem('selectedMeeting', JSON.stringify(meetingInfo));
            
            log('예약 시뮬레이션 데이터 설정 완료');
            alert('예약 시뮬레이션 데이터가 설정되었습니다. 이제 다른 페이지에서 테스트할 수 있습니다.');
        }

        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', () => {
            // meetingCounts 초기화 확인
            if (!sessionStorage.getItem('meetingCounts')) {
                sessionStorage.setItem('meetingCounts', JSON.stringify({
                    progressive: { male: 0, female: 0 },
                    conservative: { male: 0, female: 0 }
                }));
                log('meetingCounts 초기화됨');
            }
            
            refreshDisplay();
            log('페이지 로드 완료');
        });

        // storage 이벤트 리스너 (다른 탭에서의 변경 감지)
        window.addEventListener('storage', (e) => {
            if (e.key === 'meetingCounts') {
                log('다른 탭에서 meetingCounts가 변경됨');
                refreshDisplay();
            }
        });
    </script>
</body>
</html>